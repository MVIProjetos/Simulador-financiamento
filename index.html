<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Financiamento</title>
  <style>
    /* Estilos Globais */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .container {
      background-color: #fff;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    label {
      display: block;
      margin-top: 15px;
      color: #555;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 1em;
    }
    button {
      display: block;
      width: 100%;
      margin-top: 20px;
      padding: 12px;
      font-size: 1.1em;
      background-color: #007BFF;
      border: none;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .resultado {
      margin-top: 25px;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
      font-size: 0.9em;
    }
    th {
      background-color: #007BFF;
      color: #fff;
    }
    .alerta {
      color: #ff0000;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Simulador de Financiamento</h2>
    <!-- Formulário de Entrada -->
    <label for="valorFinanciado">Valor Financiado (R$):</label>
    <input type="number" id="valorFinanciado" placeholder="Ex.: 300000" />

    <label for="taxaJuros">Taxa de Juros (% ao mês):</label>
    <input type="number" id="taxaJuros" placeholder="Ex.: 1" step="0.01"/>

    <label for="prazo">Prazo (em meses):</label>
    <input type="number" id="prazo" placeholder="Ex.: 360"/>

    <label for="amortizacaoExtra">Valor para Amortização Extra (R$):</label>
    <input type="number" id="amortizacaoExtra" placeholder="Ex.: 500" step="0.01"/>

    <label for="tipoAmortizacao">Tipo de Amortização:</label>
    <select id="tipoAmortizacao">
      <option value="price">Price</option>
      <option value="sac">SAC</option>
    </select>

    <button onclick="calcularFinanciamento()">Calcular</button>

    <div class="resultado" id="resultado"></div>
  </div>

  <script>
    // Função para formatar valores em reais
    function formatarMoeda(valor) {
      return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Função para calcular o financiamento e gerar a tabela de amortização
    function calcularFinanciamento() {
      // Recupera os valores dos campos
      let valor = parseFloat(document.getElementById('valorFinanciado').value);
      let taxa = parseFloat(document.getElementById('taxaJuros').value) / 100; // converter para decimal
      let prazo = parseInt(document.getElementById('prazo').value);
      let extra = parseFloat(document.getElementById('amortizacaoExtra').value) || 0;
      let tipo = document.getElementById('tipoAmortizacao').value;
      const resultadoDiv = document.getElementById('resultado');

      // Valida os dados
      if (isNaN(valor) || isNaN(taxa) || isNaN(prazo) || valor <= 0 || prazo <= 0) {
        resultadoDiv.innerHTML = '<p class="alerta">Por favor, preencha corretamente os campos obrigatórios.</p>';
        return;
      }

      let tabelaHTML = '<table><thead><tr>';
      tabelaHTML += '<th>Mês</th><th>Parcela</th><th>Amortização</th><th>Juros</th><th>Extra</th><th>Saldo Devedor</th>';
      tabelaHTML += '</tr></thead><tbody>';

      let saldoDevedor = valor;
      let mes = 1;
      let totalParcelas = 0;

      if (tipo === 'price') {
        // Cálculo da parcela fixa para Price
        const parcelaFixa = valor * ((taxa * Math.pow(1 + taxa, prazo)) / (Math.pow(1 + taxa, prazo) - 1));
        // Simulação enquanto houver saldo devedor
        while (saldoDevedor > 0.01 && mes <= prazo * 2) { // Limite de iterações para evitar loop infinito
          let jurosMes = saldoDevedor * taxa;
          let amortizacao = parcelaFixa - jurosMes;
          // Aplica amortização extra (se houver)
          let amortizacaoExtra = extra;
          let totalAmortizacao = amortizacao + amortizacaoExtra;
          // Evita amortizar além do saldo devedor
          if (totalAmortizacao > saldoDevedor) {
            totalAmortizacao = saldoDevedor;
          }
          let parcelaTotal = jurosMes + totalAmortizacao;
          saldoDevedor -= totalAmortizacao;
          if (saldoDevedor < 0) saldoDevedor = 0;

          tabelaHTML += `<tr>
                          <td>${mes}</td>
                          <td>${formatarMoeda(parcelaTotal)}</td>
                          <td>${formatarMoeda(totalAmortizacao)}</td>
                          <td>${formatarMoeda(jurosMes)}</td>
                          <td>${formatarMoeda(amortizacaoExtra)}</td>
                          <td>${formatarMoeda(saldoDevedor)}</td>
                        </tr>`;
          mes++;
          totalParcelas++;
        }
      } else if (tipo === 'sac') {
        // Cálculo da amortização fixa para SAC
        const amortizacaoFixa = valor / prazo;
        while (saldoDevedor > 0.01 && mes <= prazo * 2) { // Limite de iterações para evitar loop infinito
          let jurosMes = saldoDevedor * taxa;
          let amortizacaoExtra = extra;
          let totalAmortizacao = amortizacaoFixa + amortizacaoExtra;
          if (totalAmortizacao > saldoDevedor) {
            totalAmortizacao = saldoDevedor;
          }
          let parcelaTotal = jurosMes + totalAmortizacao;
          saldoDevedor -= totalAmortizacao;
          if (saldoDevedor < 0) saldoDevedor = 0;
          
          tabelaHTML += `<tr>
                          <td>${mes}</td>
                          <td>${formatarMoeda(parcelaTotal)}</td>
                          <td>${formatarMoeda(totalAmortizacao)}</td>
                          <td>${formatarMoeda(jurosMes)}</td>
                          <td>${formatarMoeda(amortizacaoExtra)}</td>
                          <td>${formatarMoeda(saldoDevedor)}</td>
                        </tr>`;
          mes++;
          totalParcelas++;
        }
      }

      tabelaHTML += '</tbody></table>';
      let resumo = `<p><strong>Total de parcelas pagas: </strong>${totalParcelas}</p>`;
      resultadoDiv.innerHTML = resumo + tabelaHTML;
    }
  </script>
</body>
</html>
