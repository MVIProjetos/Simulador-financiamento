<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Financiamento Avançado</title>
  <!-- Importa a fonte Roboto do Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Reset básico */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    /* Estilo do body com fundo em degradê e centralização */
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #74ABE2, #5563DE);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
      padding: 1rem;
    }
    
    /* Card central com sombra e bordas arredondadas */
    .card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 800px;
      padding: 2rem;
    }
    
    /* Cabeçalho do card */
    .card h1 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #333;
    }
    
    /* Grupos de formulário */
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #555;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    
    /* Estilo para o grupo de rádio */
    .radio-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .radio-group label {
      display: flex;
      align-items: center;
      font-size: 0.95rem;
      color: #555;
    }
    
    .radio-group input[type="radio"] {
      margin-right: 0.25rem;
    }
    
    /* Botão de ação */
    button {
      display: block;
      width: 100%;
      padding: 1rem;
      background: #5563DE;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    button:hover {
      background: #3a45b1;
    }
    
    /* Área de resultados */
    .result {
      margin-top: 2rem;
      text-align: center;
      font-size: 1.2rem;
    }
    
    .result .meses {
      color: #5563DE;
      font-weight: 700;
    }
    
    .result .economia {
      color: #28a745;
      font-weight: 700;
    }
    
    /* Mensagens de alerta */
    .alerta {
      color: #ff0000;
      font-weight: bold;
      margin-top: 1rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Simulador de Financiamento</h1>
    
    <!-- Campo Valor Financiado -->
    <div class="form-group">
      <label for="valorFinanciado">Valor Financiado (R$):</label>
      <input type="number" id="valorFinanciado" placeholder="Ex.: 300000" step="0.01">
    </div>
    
    <!-- Campo Taxa de Juros Anual -->
    <div class="form-group">
      <label for="taxaJuros">Taxa de Juros Anual (%):</label>
      <input type="number" id="taxaJuros" placeholder="Ex.: 12" step="0.01">
    </div>
    
    <!-- Campo Prazo Total -->
    <div class="form-group">
      <label for="prazo">Prazo Total (em meses):</label>
      <input type="number" id="prazo" placeholder="Ex.: 360">
    </div>
    
    <!-- Campo Valor de Amortização Extra -->
    <div class="form-group">
      <label for="amortizacaoExtra">Valor de Amortização Extra (R$):</label>
      <input type="number" id="amortizacaoExtra" placeholder="Ex.: 50000" step="0.01">
    </div>
    
    <!-- Campo Pagamentos já realizados -->
    <div class="form-group">
      <label>Já Pagou:</label>
      <div class="radio-group">
        <label>
          <input type="radio" name="tipoPago" value="meses" checked> Em Meses
        </label>
        <label>
          <input type="radio" name="tipoPago" value="valor"> Em Valor (R$)
        </label>
      </div>
      <input type="number" id="valorPago" placeholder="Ex.: 12 (se em meses) ou 36000 (se em valor)" step="0.01">
    </div>
    
    <!-- Campo Tipo de Amortização -->
    <div class="form-group">
      <label for="tipoAmortizacao">Tipo de Amortização:</label>
      <select id="tipoAmortizacao">
        <option value="price">Price</option>
        <option value="sac">SAC</option>
      </select>
    </div>
    
    <button onclick="calcularFinanciamento()">Calcular</button>
    
    <div class="result" id="resultado"></div>
  </div>
  
  <script>
    // Formata um valor numérico para moeda (pt-BR)
    function formatarMoeda(valor) {
      return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }
    
    function calcularFinanciamento() {
      // Coleta os valores dos campos
      let P = parseFloat(document.getElementById('valorFinanciado').value);
      let taxaAnual = parseFloat(document.getElementById('taxaJuros').value);
      let n = parseInt(document.getElementById('prazo').value);
      let extra = parseFloat(document.getElementById('amortizacaoExtra').value) || 0;
      let tipo = document.getElementById('tipoAmortizacao').value;
      let tipoPago = document.querySelector('input[name="tipoPago"]:checked').value;
      let pagoInput = parseFloat(document.getElementById('valorPago').value) || 0;
      const resultadoDiv = document.getElementById('resultado');
      
      // Validação dos campos obrigatórios
      if (isNaN(P) || isNaN(taxaAnual) || isNaN(n) || P <= 0 || n <= 0) {
        resultadoDiv.innerHTML = '<p class="alerta">Preencha corretamente os campos obrigatórios.</p>';
        return;
      }
      
      // Converte taxa anual para taxa mensal (decimal)
      let i = (taxaAnual / 100) / 12;
      
      // Cálculo da parcela fixa para Price
      let A = 0;
      if (tipo === 'price') {
        A = P * ((i * Math.pow(1 + i, n)) / (Math.pow(1 + i, n) - 1));
      }
      
      // Determina quantos meses já foram pagos (k) e o valor total já pago
      let k = 0;
      let valorPagoTotal = 0;
      if (tipoPago === 'meses') {
        k = Math.floor(pagoInput);
        if (tipo === 'price') {
          valorPagoTotal = A * k;
        } else if (tipo === 'sac') {
          let amortizacaoFixa = P / n;
          let somaJuros = 0;
          let saldo = P;
          for (let j = 1; j <= k; j++) {
            let jurosMes = saldo * i;
            somaJuros += jurosMes;
            saldo -= amortizacaoFixa;
          }
          valorPagoTotal = (amortizacaoFixa * k) + somaJuros;
        }
      } else if (tipoPago === 'valor') {
        valorPagoTotal = pagoInput;
        if (tipo === 'price') {
          k = Math.floor(valorPagoTotal / A);
        } else if (tipo === 'sac') {
          let amortizacaoFixa = P / n;
          let soma = 0;
          k = 0;
          let saldo = P;
          while (soma < valorPagoTotal && k < n) {
            let jurosMes = saldo * i;
            soma += amortizacaoFixa + jurosMes;
            saldo -= amortizacaoFixa;
            k++;
          }
        }
      }
      
      // Se já pagou o suficiente para quitar o financiamento:
      if (k >= n) {
        resultadoDiv.innerHTML = '<p class="alerta">O financiamento já foi quitado.</p>';
        return;
      }
      
      // Calcula o saldo devedor remanescente com base no sistema escolhido
      let saldoRestante = 0;
      if (tipo === 'price') {
        saldoRestante = P * (Math.pow(1 + i, n) - Math.pow(1 + i, k)) / (Math.pow(1 + i, n) - 1);
      } else if (tipo === 'sac') {
        saldoRestante = P - (P / n) * k;
      }
      
      // Cenário SEM amortização extra
      let mesesSemExtra = n - k;
      let jurosSemExtra = 0;
      if (tipo === 'price') {
        jurosSemExtra = A * mesesSemExtra - saldoRestante;
      } else if (tipo === 'sac') {
        for (let j = 1; j <= mesesSemExtra; j++) {
          let saldoMes = saldoRestante - (P / n) * (j - 1);
          jurosSemExtra += saldoMes * i;
        }
      }
      
      // Cenário COM amortização extra: aplica o valor extra no saldo restante
      let saldoNovo = saldoRestante - extra;
      if (saldoNovo < 0) saldoNovo = 0;
      
      let mesesComExtra = 0;
      let jurosComExtra = 0;
      if (tipo === 'price') {
        if (saldoNovo > 0) {
          mesesComExtra = Math.ceil(Math.log(A / (A - saldoNovo * i)) / Math.log(1 + i));
        } else {
          mesesComExtra = 0;
        }
        jurosComExtra = A * mesesComExtra - saldoNovo;
      } else if (tipo === 'sac') {
        let amortizacaoFixa = P / n;
        mesesComExtra = Math.ceil(saldoNovo / amortizacaoFixa);
        for (let j = 1; j <= mesesComExtra; j++) {
          let saldoMes = saldoNovo - amortizacaoFixa * (j - 1);
          if (saldoMes < 0) saldoMes = 0;
          jurosComExtra += saldoMes * i;
        }
      }
      
      // Calcula os ganhos
      let mesesAbatidos = mesesSemExtra - mesesComExtra;
      let jurosEconomizados = jurosSemExtra - jurosComExtra;
      
      // Exibe os resultados com cores diferentes
      let resultadoHTML = `<p class="meses">Meses abatidos: <span>${mesesAbatidos}</span></p>`;
      resultadoHTML += `<p class="economia">Valor economizado (em juros): <span>${formatarMoeda(jurosEconomizados)}</span></p>`;
      
      resultadoDiv.innerHTML = resultadoHTML;
    }
  </script>
</body>
</html>
